#!/usr/bin/env ruby

require 'superstacker/template'
require 'thor'
require 'json'

module Cli
  class Template < Thor

    desc 'compile DIR', 'Compile the SuperStacker template in DIR.'
    def compile(dir)
      template_file = File.join(File.expand_path(dir), 'template.rb')
      template = File.open(template_file) { |f| f.read }

      ss_template = ::SuperStacker::Template::Template.new(template)
      puts JSON.pretty_generate(ss_template.compile)
    end

  end

  class SuperStacker < Thor

    desc 'template SUBCOMMAND',
      'superstacker commands related to cloudformation templates'
    subcommand :template, Template

  end
end

Cli::SuperStacker.start(ARGV)
